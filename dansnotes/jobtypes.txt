
shortname vb2cub
description Convert Cube

requires cpu

data <name> " "

data <name>
 ...
end

# string foo=jt->getData("ref");

## if there's a "command" it's commandline, if there's an "internal" it's internal
## so do away with invocation

# the following two possibilities disambiguated on basis of number of tokens on argument line

argument type=string name=3dfile default="in.cub" desc="This is the input file."

## OR:

argument
 name=infile
 desc=3D file/dir
 type=string
 default=none
[low=, high=, etc.]
 role=[input/output]
end

command vb2cub $(infile) $(outfile)
...

-------------------------------------------------------------------------------

# $0 - directory (typically anatomy)
# $1 - paramfile
# $2 - your volume
# $3 - ref volume
# $4 - vox_x
# $5 - vox_y
# $6 - vox_z
# $7 - bounding box

description SPM2 Normalization -- calculate parameters
invocation script
requires cpu
requires matlab
retry_tag Try again later
setenv MATLABPATH=/usr/local/spm2
setenv HOME=/tmp
argument dir
argdesc directory
type string
default none
low/high none/none
argument paramfile
argdesc file containing params
type string
default none
low/high none/none
argument volume
argdesc your volume
type string
default none
low/high none/none
argument refvolume
argdesc  reference volume
type string
default none
low/high none/none
argument voxx
argdesc vox_x size
type long
default none
low/high none/none
argument voxy
argdesc vox_y size
type long
default none
low/high none/none
argument voxz
argdesc vox_z size
type long
default none
low/high none/none
argument boundingbox
argdesc bounding box
type string
default none
low/high none/none
command vb2img $0/$2 $0/tmp_spm2norm.img
# for fun, add  -logfile /jet/kimberg/test/spmnorm/matlab.log
command /usr/local/bin/matlab12 -nodisplay -nojvm -c 27000@ictus.med.upenn.edu:27000@aleida.uphs.upenn.edu
| spm_defaults;
| global defaults;
| cd $0;
| defaults.normalise.write.vox=[$4 $5 $6];
| defaults.normalise.write.interp=7;
| defaults.normalise.write.wrap=[0 0 0];
| defaults.normalise.write.bb=$7;
| VG=spm_vol('$3')
| V=spm_vol('$0/tmp_spm2norm.img')
| params=spm_normalise(VG,V,'$0/$1','','',defaults.normalise.estimate);
| msk=spm_write_sn(V,params,defaults.normalise.write,'mask');
| spm_write_sn(V,params,defaults.normalise.write,msk);
| exit
command vb2cub $0/wtmp_spm2norm.img $0/n$2
command /bin/rm $0/tmp_spm2norm.img $0/tmp_spm2norm.hdr
command /bin/rm $0/wtmp_spm2norm.img $0/wtmp_spm2norm.hdr
command test -e $0/$1
